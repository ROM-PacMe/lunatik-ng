obj-y += bindings/

lua_objects := lapi.o lcode.o ldebug.o ldo.o ldump.o lfunc.o lgc.o llex.o \
	lmem.o lobject.o lopcodes.o lparser.o lstate.o lstring.o ltable.o \
	ltm.o lundump.o lvm.o lzio.o lauxlib.o

lua_headers := lapi.h lauxlib.h lcode.h ldebug.h ldo.h lfunc.h lgc.h \
	llex.h llimits.h lmem.h lobject.h lopcodes.h lparser.h lstate.h \
	lstring.h ltable.h ltm.h lua.h luaconf.h lundump.h lvm.h lzio.h

$(foreach lua_object, $(lua_objects), \
	$(eval CFLAGS_$(lua_object) = -I$(src)/fakelibc_include))

obj-$(CONFIG_LUNATIK) += lunatik_core.o
lunatik_core-objs := lunatik_kworkqueue.o lunatik.o
lunatik_core-objs += $(lua_objects)

# syscall cannot be defined in a module
obj-$(CONFIG_LUNATIK_SYSCALL) += lunatik_syscall.o

ifeq ($(ARCH),x86)
  lunatik_core-objs += setjmp_$(ARCH)_$(BITS).o
endif

#
# Add autogenerated list of exports
#

lunatik_core-objs += ksyms.o
CFLAGS_ksyms.o = -I$(src)/fakelibc_include

$(obj)/ksyms.o: $(obj)/ksyms.c

quiet_cmd_lua_ksyms = GEN     $@
      cmd_lua_ksyms = $(CONFIG_SHELL) $^ > $@

$(obj)/ksyms.c: $(src)/gen_ksyms.sh $(addprefix $(src)/,$(lua_headers)) $(addprefix $(obj)/,$(lua_objects))
	$(call cmd,lua_ksyms)

clean-files += ksyms.c
